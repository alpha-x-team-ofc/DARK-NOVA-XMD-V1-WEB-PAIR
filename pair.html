<!DOCTYPE html>
<html lang="en">
<head>
  <!-- [Previous head content remains the same until script] -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const pairElement = document.getElementById("pair");
      const submitButton = document.getElementById("submit");
      const numberInput = document.getElementById("number");
      const loadingSpinner = document.getElementById("loading-spinner");

      async function copyToClipboard() {
        try {
          const text = document.getElementById("copy").innerText;
          const obj = document.getElementById("copy");
          await navigator.clipboard.writeText(obj.innerText.replace('CODE: ', ''));
          obj.innerText = "✔️ COPIED";
          obj.style = "color:blue;font-weight:bold";
          setTimeout(() => {
            obj.innerText = text;
            obj.style = "color:white;font-weight-bold";
          }, 2000);
        } catch (err) {
          console.error('Failed to copy:', err);
          alert('Failed to copy text. Please copy manually.');
        }
      }

      submitButton.addEventListener("click", async (e) => {
        e.preventDefault();
        
        if (!numberInput.value) {
          pairElement.innerHTML = '<span style="color:red;font-weight:bold">❗Enter your WhatsApp number with country code.</span><br><br>';
          return;
        }

        const cleanNumber = numberInput.value.replace(/[^0-9]/g, "");
        if (cleanNumber.length < 11) {
          pairElement.innerHTML = '<span style="color:red;font-weight:bold">❗Invalid number format. Please try again.</span><br><br>';
          return;
        }

        // Format number display
        numberInput.type = "text";
        numberInput.value = `+${cleanNumber.substring(0, 3)} ${cleanNumber.substring(3, 8)} ${cleanNumber.substring(8)}`;
        numberInput.style = "color:white;font-size:20px";

        // Show loading spinner
        loadingSpinner.style.display = "block";
        pairElement.innerHTML = '';

        try {
          const response = await axios.get(`/code?number=${cleanNumber}`);
          const code = response.data?.code || "❗ Service Unavailable";
          
          pairElement.innerHTML = `
            <font id="copy" onclick="copyToClipboard()" style="color:blue;font-weight:bold">
              CODE: <span style="color:white;font-weight:bold">${code}</span>
            </font>
            <br><br>
            <small style="color:white">Click the code to copy</small>
          `;
        } catch (error) {
          console.error('Error:', error);
          pairElement.innerHTML = '<span style="color:red;font-weight:bold">❗Error getting pairing code. Please try again.</span>';
        } finally {
          loadingSpinner.style.display = "none";
        }
      });
    });
  </script>
</body>
</html>
